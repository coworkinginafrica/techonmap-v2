<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>TechOnMap v2</title>
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"></meta>
<style>
</style>
</head>
<body>
	<button onClick="javascript:login()">Say hello</button>
	<script type="text/javascript">
        var finished = false;
        var onLoginFinished = function() {
            if (finished)
                return;
            finished = true;
            if (window.opener.onLoginFinished) {
                var opener = window.opener;
                opener.onLoginFinished.apply(opener, arguments);
            }
        }
        window.addEventListener("beforeunload", function(e) {
            onLoginFinished({
                cancel : true
            });
        }, false);
        function login() {
            onLoginFinished({
                cancel : false,
                user : {
                    user : 'John Doe',
                    message : 'This is a login'
                }
            });
            window.close();
        }
    </script>
</body>
</html>


